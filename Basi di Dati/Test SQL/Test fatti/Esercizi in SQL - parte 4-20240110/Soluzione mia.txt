--1 
select g.codice, cittanascita
from giornalista g
	join firma f on f.codice = g.codice
where anno >= 2000;

--2
select distinct f1.nome
from testata t 	
	join firma f1 on f1.nome = t.nome
	join firma f2 on f2.codice = f1.codice
where f1.mese = f2.mese+1 and f1.anno = f2.anno;

--3
with e3 (codice, n_articoli) as (
	select f.codice, sum(articoli) 
	from giornalista g 
		join firma f on f.codice = g.codice
		join testata t on t.nome = f.nome
	where t.citta = g.cittanascita
	group by f.codice
	union 
	select codice, 0
	from giornalista
	where codice not in (
		select g.codice
		from giornalista g 
			join firma f on f.codice = g.codice
			join testata t on t.nome = f.nome
		where t.citta = g.cittanascita
		group by g.codice
	)
)
select *
from e3
order by codice;

--4
select distinct t.nome
from testata t 
where t.nome not in (
	select t1.nome
	from testata t1 
		join firma f1 on t1.nome = f1.nome
		join giornalista g1 on g1.codice = f1.codice
	where g1.orientamento != 'sinistra'
	group by t1.nome
);

--5 (sbagliata)
with articoli_direttore (codice, n_articoli_annui) as (
	select t.direttore, max(articoli)
	from firma f
		join testata t on f.codice = t.direttore 
	group by t.nome, anno, t.direttore
)
select t.nome, anno
from testata t 
	join firma f on f.nome = t.nome
	join articoli_direttore ad on ad.codice = t.direttore and ad.codice = f.codice
group by t.nome, anno
having max(articoli) = max(n_articoli_annui);
 
-- 5 prof
with myview as (
     select f.nome as nome, f.anno as anno, sum(articoli) as quanti
     from firma f join testata t on f.nome=t.nome
     where f.codice=t.direttore
     group by f.nome, f.anno
)

     
select m.nome, m.anno
from myview as m
where not exists (select *
                       from myview m2
                       where m.nome=m2.nome and m2.quanti>m.quanti);
