--1
select distinct lavoratore 
from attivita
	join partecipa on codiceattivita = codice
where durata > 10;

--2
select distinct progetto, count(lavoratore)
from attivita
	join partecipa on codiceattivita = codice
group by progetto;

--3
with a as (
	select distinct lavoratore, count(codiceattivita) as c
	from partecipa
	group by lavoratore
)
select lavoratore, avg(c) as media
from a
group by lavoratore;

--4
select distinct lavoratore, progetto, sum(durata)
from attivita a 
	join partecipa p on p.codiceattivita = a.codice
group by lavoratore, progetto
union
select distinct lavoratore, progetto, 0
from (select lavoratore, progetto
      from partecipa, attivita
      except
      select lavoratore, progetto
      from attivita
	  	join partecipa p2 on attivita.codice = p2.codiceattivita) t
;
--5
select distinct p.lavoratore
from attivita a1 join partecipa p on codice = codiceattivita
where not exists (select codice 
                  from attivita a2
                  where progetto = a1.progetto and 
                        p.lavoratore not in (select lavoratore 
                                             from partecipa 
                                            where codiceattivita = a2.codice))


