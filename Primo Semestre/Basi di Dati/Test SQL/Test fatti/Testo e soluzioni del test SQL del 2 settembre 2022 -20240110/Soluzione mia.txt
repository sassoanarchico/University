--1
select distinct r.codice, giorno, valore 
from rilevazione r join centralina c on c.codice = r.codice
where valore < 1100 and tipo = 200 and citta != 'Milano';

--prof 1

select r.codice, r.giorno, r.valore
from rilevazione r join centralina c on r.codice = c.codice join citta t on t.id = c.citta where r.valore < 1100 and c.tipo = 200 and t.nome <> 'Milano';

--2
select distinct nome
from citta
	join centralina c1 on c1.citta = id
	join centralina c2 on c1.tipo = c2.tipo and c1.citta = c2.citta and c1.codice < c2.codice;

--prof 2
select distinct nome
from citta join centralina c1 on c1.citta = citta.id join centralina c2 on c2.citta = citta.id where c1.tipo = c2.tipo and c1.codice > c2.codice;

--3
select distinct c.codice, regione, count(r)
from centralina c
	left join citta on c.citta = id
	join rilevazione r on c.codice = r.codice
group by c.codice, regione
order by c.codice;

--prof
select c.codice, ci.regione, count(*)
from rilevazione r join centralina c on r.codice = c.codice join citta ci on ci.id = c.citta
group by c.codice, ci.regione
union
select c1.codice, ci1.regione, 0
from centralina c1 join citta ci1 on c1.citta = ci1.id
where c1.codice not in (select r1.codice from rilevazione r1);

--4
select codice
from centralina 
except
select distinct r.codice
from centralina c join rilevazione r on c.codice = r.codice
where giorno < 31;

--prof 4
select c1.codice
from centralina c1
where c1.codice not in (select r.codice
from rilevazione r
where giorno >= 1 and giorno <= 31);


--5

select citta.nome, min(r.giorno)
from citta join centralina c on c.citta = citta.id 
	join rilevazione r on c.codice = r.codice 
where r.valore > 500
group by citta.nome
union 
select citta.nome, null
from citta
where citta.id not in (select c1.citta
					  from centralina c1
					  	join rilevazione r2 on c1.codice = r2.codice where r2.valore > 500);
